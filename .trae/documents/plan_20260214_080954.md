# Plano de Implementação: Sistema de Tracking e Otimização Meta Ads

Este plano cobre todos os requisitos do `projeto.txt` e adiciona pontos técnicos cruciais para garantir a "aprendizagem do Meta" e a atribuição correta das vendas.

## 1. Fundação e Infraestrutura
- [ ] **Configuração do Monorepo**: Estrutura para API, Web SDK e Dashboard.
- [ ] **Banco de Dados**: PostgreSQL com tabelas otimizadas para eventos (`web_events`), compras (`purchases`) e métricas do Meta (`meta_insights`).
- [ ] **Filas e Jobs**: Configuração do BullMQ/Redis para processamento assíncrono (garantia de entrega ao Meta CAPI).

## 2. Web SDK Avançado (O "Olho" do Sistema)
- [ ] **Coleta de Dados**: Script JS leve para capturar PageView, Cliques, Tempo na Página e Performance (Load Time).
- [ ] **Identificadores Meta**: Captura e persistência de cookies `_fbp` e `_fbc`.
- [ ] **Auto-Tagging de Links (Crucial)**: Funcionalidade para injetar automaticamente `fbp`, `fbc`, `event_id` e `utms` nos links de saída (botões de compra/checkout) para garantir que o webhook receba esses dados depois.
- [ ] **Captura de UTMs**: Armazenar parâmetros de campanha (`utm_source`, `utm_campaign`, etc.) para análise de atribuição.

## 3. Backend e Ingestão de Eventos
- [ ] **API de Ingestão**: Endpoint de alta performance para receber dados do SDK.
- [ ] **Normalização**: Tratamento de User Agent, IP e hash de dados pessoais (SHA-256).
- [ ] **Deduplicação**: Lógica para garantir que o mesmo evento (pixel + server) não seja duplicado no Meta, usando `event_id`.

## 4. Webhook de Compras e Conversions API (CAPI)
- [ ] **Endpoint de Webhook**: Receber notificações de venda (Hotmart, Kiwify, etc.).
- [ ] **Enriquecimento**: Cruzar dados da venda com os dados de navegação (via `fbp`/`external_id` repassados no checkout).
- [ ] **Envio Server-Side**: Disparar evento `Purchase` para o Meta via API, com nota máxima de qualidade (Match Quality).

## 5. Integração Meta Marketing API
- [ ] **Sincronização**: Jobs diários para puxar custos, impressões e cliques das campanhas.
- [ ] **Consolidação**: Tabela unificada ligando `Ad Creative` -> `Landing Page Performance` -> `Vendas`.

## 6. Agente de Análise e Otimização (LLM)
- [ ] **Motor de Diagnóstico**: Script que analisa os dados consolidados e detecta padrões (ex: "CTR alto, mas Load Time > 3s e pouca conversão").
- [ ] **Integração OpenAI**: Enviar resumo estatístico (sem dados pessoais) para o GPT gerar insights e planos de ação.
- [ ] **Relatórios**: Gerar output textual com recomendações de otimização (Criativo, Página, Oferta).

## 7. Dashboard e Visualização
- [ ] **Painel Administrativo**: Interface para visualizar funil, erros de tracking e os relatórios do agente.
